# 知识图谱增强功能说明文档

## 概述

本文档介绍了知识图谱系统的增强功能，包括语义相似度计算、动态阈值调节、时间序列分析和图论分析等功能。

## 新增功能

### 1. 语义相似度计算

基于智谱AI的embedding模型，系统现在可以计算用户问题与公司知识库之间的语义相似度，而非简单的关键词匹配。

#### 技术实现
- 使用智谱AI的embedding-2模型进行向量化
- 通过余弦相似度算法计算语义匹配度
- 支持动态阈值调节

#### 使用方法
1. 在前端界面使用"相似度阈值"滑块调节匹配敏感度
2. 阈值越低，匹配越宽松（更多黄色节点变为绿色）
3. 阈值越高，匹配越严格（更多绿色节点变为黄色）

### 2. 时间序列分析

系统现在会记录每次图谱分析的结果，形成时间序列数据，便于追踪知识覆盖率的变化趋势。

#### 功能特点
- 自动记录每次分析的时间戳、覆盖率等指标
- 提供图表展示覆盖率趋势
- 支持按周、月、季度查看趋势

### 3. 图论分析

新增多种图论分析功能，包括：
- 度中心性分析
- 介数中心性分析  
- 聚类系数计算
- 社区发现
- 知识盲区识别

#### 用途
- 识别知识图谱中的枢纽节点（高度连接的节点）
- 发现连接不同知识领域的桥梁节点
- 识别知识盲区和断点

## 系统架构

### 后端服务

1. **VectorService** (`services/vectorService.ts`)
   - 负责文本向量化
   - 计算相似度
   - 管理向量索引

2. **CompanyKnowledgeGraph** (`services/companyKnowledgeGraph.ts`)
   - 扩展了相似度计算功能
   - 集成了时间序列记录

3. **TimeSeriesService** (`services/timeSeriesService.ts`)
   - 管理时间序列数据
   - 提供趋势分析功能

4. **GraphAnalysisService** (`services/graphAnalysisService.ts`)
   - 提供图论分析功能
   - 识别知识盲区

### 前端组件

1. **DualGraphComparison** (`components/DualGraphComparison.tsx`)
   - 集成了新的UI控件
   - 支持阈值调节
   - 支持时间轴显示
   - 集成了图分析功能

## 配置要求

### API密钥配置

在 `.env.local` 文件中配置智谱AI API密钥：

```env
ZHIPU_API_KEY=your_actual_api_key_here
```

### 依赖安装

```bash
npm install zhipuai uuid
npm install @types/uuid
```

## 使用指南

### 1. 配置API密钥
首次使用前，请在 `.env.local` 中配置有效的智谱AI API密钥。

### 2. 访问知识图谱
1. 导航到 `/admin/graph` 页面
2. 点击"实际数据"加载真实数据
3. 使用右侧的控件调节相似度阈值

### 3. 分析功能
1. **阈值调节**：使用滑块调整匹配敏感度
2. **时间轴**：勾选显示时间轴查看趋势
3. **图分析**：点击"执行图分析"识别知识盲区

## 业务价值

### 对售后业务的支持
- **热点识别**：大黄色节点表示高频用户问题
- **覆盖率分析**：绿色节点比例反映知识库覆盖情况
- **盲区发现**：识别需要补充知识的内容领域
- **趋势跟踪**：监控知识库完善程度的变化

### 决策支持
- 优先补充覆盖率低但热度高的知识点
- 识别知识库中的薄弱环节
- 量化知识管理的效果

## 注意事项

1. API调用会产生费用，请合理配置阈值以平衡准确性和成本
2. 首次加载大量数据时可能需要一些时间
3. 时间序列数据会持续增长，建议定期清理旧数据

## API端点

- `POST /api/knowledge-similarity` - 执行相似度计算
- `GET /api/knowledge-similarity` - 获取配置信息

## 故障排除

如果遇到API调用失败：
1. 检查ZHIPU_API_KEY是否正确配置
2. 确认网络连接正常
3. 检查API配额是否充足

如果图谱显示异常：
1. 清除浏览器缓存
2. 检查console是否有错误信息
3. 验证数据源是否正常